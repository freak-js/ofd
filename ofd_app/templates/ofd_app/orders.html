<!doctype html>
<html lang="ru">
<head>
    {% load static %}
    {% load crispy_forms_tags %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="{% static "bootstrap.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "stylesheet.css" %}">
    <link rel="icon" type="image/x-icon" href="{% static "favicon.ico" %}">
    <link rel="stylesheet" href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.3/themes/sunny/jquery-ui.css">
    <title>Заказы</title>
</head>
<body class="text-center">
    {% include "ofd_app/menu.html" %}
    {% include "ofd_app/filter.html" %}
    <div class="container container_min_width flex-grow-1">
        <form action="/orders/" method="POST" id="status" name="status">
        {% csrf_token %}
        <div class="row global_order_nav_div font_900">
            <div class="col-sm-1 p-1">
                <span>Заказ&nbsp№</span>
            </div>
            <div class="col-sm-1 p-1">
                <span>Клиент</span>
            </div>
            <div class="col-sm-3 p-1">
                <span>Дата</span>
            </div>
            <div class="col-sm-1 p-1">
                <span>Количество</span>
            </div>
            <div class="col-sm-2 p-1">
                <span>Комментарий</span>
            </div>
            <div class="col-sm-2 p-1">
                <span>Статус</span>
            </div>
            <div class="col-sm-1 p-1">
                <span></span>
            </div>
            <div class="col-sm-1 p-1">
                <span></span>
            </div>
        </div>
        {% for order in orders.data %}
        <div class="row global_order_nav_div">
            <div class="col-sm-1 p-1">
                <span>{{ order.order_num }}</span>
            </div>
            <div class="col-sm-1 p-1">
                <button type="button" class="btn comment_show_button" data-container="body" data-toggle="popover" data-html="true" data-placement="top" data-content="Организация: {{ order.user.org }} <br> ИНН: {{ order.user.inn }} <br> Почта: {{ order.user.email }} <br> Имя: {{ order.user.first_name }} <br> Фамилия: {{ order.user.last_name }} <br> Телефон: {{ order.user.phone_number }} <br> Роль: {{ order.user.role }}"><i class="fa fa-user"></i>
                </i></button>
            </div>
            <div class="col-sm-3 p-1">
                <span>{{ order.adddate }}</span>
            </div>
            <div class="col-sm-1 p-1">
                <span>{{ order.cnt_products }}</span>
            </div>
            <div class="col-sm-2 p-1">
                {% if order.comment %}
                <button type="button" class="btn comment_show_button" data-container="body" data-toggle="popover" data-placement="top" data-content="{{order.comment}}"><i class="fa fa-comment"></i>
                </i></button>
                {% else %}
                <span>Нет</span>
                {% endif %}
            </div>
            <div class="col-sm-2 p-1">
                {% if order.status == "I" %}
                <i class="fa fa-circle-notch fa-spin" data-toggle="tooltip" data-placement="right" title="Администратор обрабатывает ваш заказ"></i>
                {% elif order.status == "A" %}
                <i class="fa fa-check" data-toggle="tooltip" data-placement="right" title="Заказ завершен" style="color: #49884b"></i>
                {% elif order.status == "R" %}
                <i class="fa fa-times" data-toggle="tooltip" data-placement="right" title="Заказ отклонен" style="color: #bd3e35"></i>
                {% endif %}
            </div>
            <div class="col-sm-1 p-1">
                {% if perms.ofd_app.change_product %}
                {% if order.status == "I" %}
                <input type="checkbox" class="form-check-input" name="order_ids" value="{{order.id}}">
                {% endif %}
                {% endif %}
            </div>
            <div class="col-sm-1 p-1">
                <button class="btn card_btn" type="button" data-toggle="collapse" data-target="#collapseExample{{order.id}}" aria-expanded="false" aria-controls="collapseExample{{order.id}}"><i class="fa fa-chevron-down"></i></button>
            </div>
            <div class="collapse card_div" id="collapseExample{{order.id}}">
                <div class="card card-body">
                    <div class="row row_collapse_top">
                        <div class="col-sm-4">
                            <span>Название продукта</span>
                        </div>
                        <div class="col-sm-4">
                            <span>Количество</span>
                        </div>
                        <div class="col-sm-2">
                            <span>Цена</span>
                        </div>
                        <div class="col-sm-2">
                            <span>Сумма</span>
                        </div>
                    </div>
                    {% for product in order.products %}
                    <div class="row row_collapse">
                        <div class="col-sm-4">
                            <span>{{ product.product_name }}</span>
                        </div>
                        <div class="col-sm-4">
                            <span>{{ product.amount }}</span>
                        </div>
                        <div class="col-sm-2">
                            <span>{{ product.cost }}</span>
                        </div>
                        <div class="col-sm-2">
                            <span>{{ product.full_cost }}</span>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="row row_collapse_bottom">
                        <div class="col-sm-8">
                        </div>
                        <div class="col-sm-2">
                            <span><strong>Итог:</strong></span>
                        </div>
                        <div class="col-sm-2">
                            <span><strong>{{ order.total }}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        </form>
    </div>
    {% if orders.prev or orders.next %}
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            {% if orders.prev %}
            <li class="page-item">
            <a class="page-link" href="?page={{ orders.prev }}">
                <span>&laquo;</span>
            </a>
            </li>
            {% else %}
            <li class="page-item">
            <a class="page-link disabled" href="#">
                <span>&laquo;</span>
            </a>
            </li>
            {% endif %}
            {% for page in orders.count %}
            {% if orders.page == forloop.counter %}
            <li class="page-item"><a class="page-link page-link-active" href="?page={{ forloop.counter }}">{{ forloop.counter }}</a></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ forloop.counter }}">{{ forloop.counter }}</a></li>
            {% endif %}
            {% endfor %}
            {% if orders.next %}
            <li class="page-item">
            <a class="page-link" href="?page={{ orders.next }}">
                <span>&raquo;</span>
            </a>
            </li>
            {% else %}
            <li class="page-item">
            <a class="page-link disabled" href="#">
                <span>&raquo;</span>
            </a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
    {% if perms.ofd_app.change_product %}
    <div>
        <button type="submit" class="btn btn_to_complete_order" name="status" value="A" form="status">Завершить</button>
        <button type="submit" class="btn btn_to_reject_order" name="status" value="R" form="status">Отклонить</button>
    </div>
    {% endif %}
    {% include "ofd_app/footer.html" %}
</body>
</html>
